<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jacozinho do Senhor</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <style>
        :root {
            --cor-primaria: #5D4037; --cor-secundaria: #8D6E63;
            --cor-fundo: #EFEBE9; --cor-texto: #3E2723;
            --cor-branco: #FFFFFF; --cor-sucesso: #2E7D32; --cor-aviso: #FBC02D; --cor-erro: #D32F2F;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--cor-fundo); color: var(--cor-texto); display: flex; justify-content: center; min-height: 100vh; padding-bottom: 80px;}
        .app-container { background: var(--cor-branco); width: 100%; max-width: 900px; box-shadow: 0 4px 20px rgba(93,64,55,0.15); min-height: 100vh; display: flex; flex-direction: column; }
        header { background: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--cor-primaria); }
        .logo-img { max-width: 150px; display: block; margin: 0 auto 5px auto; }
        .abas { display: flex; background: #D7CCC8; }
        .aba { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; color: #5D4037; border-bottom: 3px solid transparent; transition: 0.3s;}
        .aba:hover { background: #EFEBE9; }
        .aba.ativa { background: white; border-bottom: 3px solid var(--cor-primaria); color: var(--cor-primaria); }
        main { padding: 20px; flex-grow: 1; }
        .view-section { display: none; opacity: 0; transition: opacity 0.3s; }
        .view-section.ativa { display: block; opacity: 1; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
        label { font-size: 0.8rem; color: var(--cor-secundaria); font-weight: 700; margin-bottom: 5px; display: block; text-transform: uppercase; margin-top: 15px;}
        input, select, textarea { width: 100%; padding: 10px; border: 2px solid #D7CCC8; border-radius: 8px; font-size: 0.95rem; margin-bottom: 5px; background: #fff; font-family: inherit;}
        .btn-salvar { width: 100%; padding: 15px; background-color: var(--cor-primaria); color: white; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; margin-top: 20px; font-size: 1rem; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-mini { padding: 8px 15px; font-size: 0.85rem; background: #D7CCC8; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-zap { background-color: #25D366; color: white; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-weight: bold; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; font-size: 0.8rem; }
        #areaImportar { display:none; background:#E3F2FD; border-color:#2196F3; }
        .import-box { width: 100%; height: 150px; padding: 10px; font-family: monospace; font-size: 0.85rem; border: 2px solid #90CAF9; border-radius: 8px; }
        #areaCalendarioPDF { background-color: #ffffff !important; padding: 10px; color: #000; width: 100%; }
        .logo-pdf { display: none; text-align: center; margin-bottom: 10px; } .logo-pdf img { height: 60px; }
        .calendario-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; background: var(--cor-primaria); color: white; padding: 12px; border-radius: 8px 8px 0 0; }
        .grid-dias { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; text-align: center; font-weight: bold; color: var(--cor-branco); background: var(--cor-secundaria); padding: 8px 0; font-size: 0.8rem; }
        .grid-calendario { display: grid; grid-template-columns: repeat(7, 1fr); grid-auto-rows: 95px; gap: 1px; background: #D7CCC8; border: 2px solid var(--cor-secundaria); }
        .dia-cal { background: #FFF; padding: 2px; cursor: pointer; position: relative; font-size: 0.8rem; display: flex; flex-direction: column; overflow: hidden; }
        .dia-cal:hover { background: #FFF8E1; overflow-y: auto; }
        .dia-cal.hoje { background: #E0F2F1; }
        .evento-chip { font-size: 0.65rem; background: var(--cor-primaria); color: white; padding: 3px 5px; border-radius: 3px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; display: block; line-height: 1.2; }
        .pendente { background: var(--cor-aviso) !important; color: #3E2723 !important; }
        #barraSalvar { display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #3E2723; color: white; padding: 12px 25px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); z-index: 1000; align-items: center; gap: 15px; }
        .area-modal { display: none; background: #FFF; padding: 20px; border: 1px solid #ddd; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-left: 5px solid var(--cor-primaria); }
        .checklist-container { border: 2px solid #D7CCC8; border-radius: 8px; max-height: 250px; overflow-y: auto; padding: 10px; background: #FAFAFA; }
        .checklist-item { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #eee; }
        .checklist-item input { margin-right: 10px; width: 18px; height: 18px; accent-color: var(--cor-primaria); }
        .card-escala { background: #FFF; border-radius: 8px; padding: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; border-left: 5px solid var(--cor-primaria); box-shadow: 0 2px 5px rgba(0,0,0,0.05); align-items: center; }
        .btn-acao { border: none; background: none; font-size: 1.2rem; cursor: pointer; opacity: 0.7; }
        .esconder-na-foto { display: inline-block; }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <img src="logo.png" class="logo-img">
            <div class="abas">
                <div class="aba ativa" onclick="mudarAba('tab-escala', this)">üìã ESCALAS</div>
                <div class="aba" onclick="mudarAba('tab-calendario', this)">üìÖ CALEND√ÅRIO</div>
            </div>
        </header>

        <main>
            <div id="tab-escala" class="view-section ativa">
                <div style="display:flex; gap:10px; margin-bottom:15px">
                    <button onclick="toggleArea('areaCadastro')" class="btn-mini" style="flex:1">‚ûï Novo Servo</button>
                    <button onclick="toggleArea('areaGerenciar'); carregarParaGerenciar(false)" class="btn-mini" style="flex:1">‚öôÔ∏è Gerenciar</button>
                </div>

                <div id="areaCadastro" class="area-modal">
                    <h3 style="color:var(--cor-primaria)">Novo Cadastro</h3>
                    <input type="text" id="novoNome" placeholder="Nome Completo">
                    <input type="text" id="novoTelefone" placeholder="WhatsApp (Ex: 83999998888)">
                    <select id="novoMinisterio"><option value="M√∫sica">M√∫sica</option><option value="Acolhida">Acolhida</option><option value="Prega√ß√£o">Prega√ß√£o</option><option value="Intercess√£o">Intercess√£o</option><option value="Outros">Outros</option></select>
                    <button id="btnSalvarServo" onclick="salvarNovoServo()" class="btn-mini" style="width:100%; margin-top:10px; background:var(--cor-primaria); color:white">Salvar Cadastro</button>
                </div>
                
                <div id="areaGerenciar" class="area-modal">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; flex-wrap:wrap; gap:5px;">
                        <h3>Gerenciar Equipe</h3>
                        <div style="display:flex; gap:5px;">
                            <button onclick="alternarModoLixeira()" id="btnLixeira" class="btn-mini" style="background:#FFAB91; color:#3E2723">üóëÔ∏è Ver Lixeira</button>
                            <button onclick="toggleArea('areaImportar')" class="btn-mini" style="background:#2196F3; color:white">üì§ Importar</button>
                        </div>
                    </div>

                    <div id="areaImportar" class="area-modal" style="border:none; padding:10px; margin-bottom:10px;">
                        <h4>Importador Turbo üöÄ</h4>
                        <textarea id="txtImportar" class="import-box" placeholder="Cole sua lista aqui (Nome, Telefone)..."></textarea>
                        <button onclick="processarImportacao()" class="btn-mini" style="background:#4CAF50; color:white; width:100%; margin-top:5px">Processar e Salvar</button>
                    </div>

                    <input type="text" id="buscaGerencia" placeholder="Buscar..." onkeyup="filtrarGerencia()">
                    <div id="listaGerencia" style="max-height:200px;overflow-y:auto; margin-top:10px"></div>
                </div>

                <form id="formEscala">
                    <label>Respons√°vel:</label> <input type="text" id="inputResponsavel" required>
                    <label>Data:</label> <input type="date" id="dataEscala" required onchange="carregarEscalaDoDia()">
                    <label>Minist√©rio:</label> 
                    <select id="selectMinisterio" required onchange="filtrarListaPorMinisterio()">
                        <option value="">Selecione...</option>
                        <option value="Geral">Todos</option>
                        <option value="M√∫sica">M√∫sica</option>
                        <option value="Comunica√ß√£o">Comunica√ß√£o</option>
                        <option value="Acolhida">Acol